<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jasa Lowongan Kerja Tani Binangun – Pasang & Cari Pekerja</title>

  <!-- 🔍 SEO dasar -->
  <meta name="description" content="Pasang dan cari lowongan kerja tani di wilayah Binangun dan sekitarnya. Gratis, cepat, dan mudah. Cocok untuk petani serta pencari kerja harian." />
  <meta name="keywords"    content="lowongan tani, pekerjaan tani, jasa petani, pekerja harian, Binangun, pertanian, pasang lowongan tani, petani tuban" />
  <meta name="author"      content="Biresty Management" />

  <!-- ✅ Google Search Console verifikasi -->
  <meta name="google-site-verification" content="iLydJKgLYAblyxR9n-gIHCiSOGQCSFvNyMe9zDHH9Ow" />

  <!-- 🌐 Open Graph untuk preview link -->
  <meta property="og:title"       content="Lowongan Tani Wilayah Binangun" />
  <meta property="og:description" content="Cari &amp; pasang lowongan kerja pertanian dengan mudah. Cocok untuk warga desa, petani, dan pencari kerja lokal." />
  <meta property="og:image"       content="https://petanituban.github.io/jasatani-web/Logo.png" />
  <meta property="og:url"         content="https://petanituban.github.io/jasatani-web/" />
  <meta name="theme-color"        content="#22c55e" />

  <link rel="icon" href="Logo.png" />
  <style>
    body{font-family:sans-serif;margin:0;background:#f0fdf4;color:#1e293b}
    /* — HEADER — */
    header{background:#22c55e;color:#fff;padding:10px 20px}
    header .bar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    header .title h1{font-size:1.1rem;margin:0;line-height:1.4}
    header .title span{font-weight:normal;font-size:.9rem}
    header img{height:40px;border-radius:6px;margin-right:8px}
    .auth button{background:#fff;color:#22c55e;border:none;border-radius:6px;padding:6px 10px;font-weight:bold;cursor:pointer}
    /* — FORM & LIST — */
    .container{max-width:800px;margin:auto;padding:20px}
    form{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:30px}
    input,textarea{width:100%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:6px}
    button.submit{background:#22c55e;color:#fff;padding:12px;width:100%;border:none;border-radius:6px;font-size:1rem;cursor:pointer}
    .job-card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.1);margin-bottom:20px}
    .job-card.terisi{opacity:.5}
    .job-card a,.job-card button{margin-top:10px;display:inline-block;background:#16a34a;color:#fff;padding:8px 12px;border-radius:6px;text-decoration:none;border:none}
    .job-card button[disabled]{background:#9ca3af}
    /* — FOOTER & TENTANG — */
    .about{text-align:center;margin:40px auto}
    .about img{width:100px;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    footer{text-align:center;font-size:.9rem;color:#6b7280;margin:40px 0}
  </style>
</head>
<body>
  <!-- ====== HEADER ====== -->
  <header>
    <div class="bar">
      <div class="title">
        <h1>
          JASA PASANG LOWONGAN DAN PENCARI KERJA<br>
          SEPUTAR DUNIA PERTANIAN<br>
          <span>Wilayah Binangun dan sekitarnya</span>
        </h1>
      </div>
      <div class="auth">
        <span id="userInfo"></span>
        <button id="loginBtn">Login</button>
        <button id="logoutBtn" style="display:none;">Logout</button>
      </div>
    </div>
  </header>

  <!-- ====== DISCLAIMER ====== -->
  <div style="background:#fff4dc;color:#92400e;padding:10px;text-align:center;font-size:.9rem">
    ⚠️ <strong>Disclaimer:</strong> Segala bentuk kerugian atau kecurangan dari pihak pemberi dan penerima kerja adalah tanggung jawab masing-masing.
  </div>

  <!-- ====== CONTENT ====== -->
  <div class="container">
    <h2>Pasang Lowongan</h2>
    <form id="formPekerjaan">
      <input type="text" id="judul" placeholder="Judul Pekerjaan" required />
      <input type="date" id="tanggal" required />
      <input type="text" id="upah" placeholder="Upah (Rp)" required />
      <textarea id="deskripsi" placeholder="Deskripsi Pekerjaan" required></textarea>
      <input type="text" id="wa" placeholder="Nomor WA (628xxxxxx)" required />
      <button type="submit" class="submit">📢 Pasang Lowongan</button>
    </form>

    <h2>📋 Daftar Lowongan</h2>
    <div id="daftarLowongan"><p>Memuat data...</p></div>
  </div>

  <!-- ====== ABOUT ====== -->
  <div class="container about">
    <h3>Tentang Pembuat Web</h3>
    <img src="Joko.jpg" alt="Joko" />
    <p style="font-weight:bold;margin-top:10px">Biresty Management</p>
  </div>

  <footer>
    Dibuat oleh <a href="https://wa.me/6289607633666" target="_blank">Mr. Begox Ndangun</a>
  </footer>

  <!-- ====== FIREBASE & APP SCRIPT ====== -->
  <script type="module">
    import { initializeApp }                                     from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc,
             updateDoc }                                         from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup,
             onAuthStateChanged, signOut }                       from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    /* --- Firebase config --- */
    const firebaseConfig = {
      apiKey: "AIzaSyCWI_6BARGGu8WfHwyAU7WR-KCaTwNIB30",
      authDomain: "jasa-pekerja-tani-tuban-6a972.firebaseapp.com",
      projectId: "jasa-pekerja-tani-tuban-6a972",
      storageBucket: "jasa-pekerja-tani-tuban-6a972.appspot.com",
      messagingSenderId: "202591906654",
      appId: "1:202591906654:web:754c531b44508821033dcf"
    };

    /* --- Init --- */
    const app  = initializeApp(firebaseConfig);
    const db   = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    let currentUser = null;

    /* --- Auth buttons --- */
    const loginBtn  = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo  = document.getElementById('userInfo');

    loginBtn.onclick  = () => signInWithPopup(auth, provider).catch(e => alert("Login gagal: "+e.message));
    logoutBtn.onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      currentUser = user;
      userInfo.textContent = user ? user.displayName : "";
      loginBtn.style.display  = user ? "none"  : "inline-block";
      logoutBtn.style.display = user ? "inline-block" : "none";
      tampilkanLowongan();
    });

    /* --- Submit form --- */
    document.getElementById('formPekerjaan').addEventListener('submit', async e => {
      e.preventDefault();
      if (!currentUser) { alert("Silakan login dahulu."); return; }

      const data = {
        judul     : document.getElementById('judul').value.trim(),
        tanggal   : document.getElementById('tanggal').value,
        upah      : document.getElementById('upah').value.trim(),
        deskripsi : document.getElementById('deskripsi').value.trim(),
        wa        : document.getElementById('wa').value.trim(),
        status    : "tersedia",
        uid       : currentUser.uid,
        dibuat    : Date.now()
      };

      try {
        await addDoc(collection(db,'pekerjaan'), data);
        alert("✅ Lowongan berhasil ditambahkan!");
        e.target.reset();
        tampilkanLowongan();
      } catch(err) {
        alert("❌ Gagal menyimpan: "+err.message);
      }
    });

    /* --- Tampilkan daftar --- */
    async function tampilkanLowongan() {
      const box = document.getElementById('daftarLowongan');
      box.innerHTML = "<p>Memuat...</p>";

      try {
        const snap = await getDocs(collection(db,'pekerjaan'));
        box.innerHTML = "";
        snap.forEach(d => {
          const data = d.data();
          const card = document.createElement('div');
          card.className = "job-card" + (data.status==="terisi"?" terisi":"");
          card.innerHTML = `
            <h3>${data.judul}</h3>
            <p><strong>Tanggal:</strong> ${data.tanggal}</p>
            <p><strong>Upah:</strong> ${data.upah}</p>
            <p>${data.deskripsi}</p>
            <a href="https://wa.me/${data.wa}" target="_blank">📲 Saya Tertarik</a>
            ${data.status==="tersedia"
              ? '<button class="mark-terisi">✅ Tandai Sudah Terisi</button>'
              : '<p><em>❌ Sudah Terisi</em></p>'}`;
          const btn = card.querySelector('.mark-terisi');
          if (btn) {
            if (currentUser && currentUser.uid===data.uid){
              btn.onclick = async () => {
                await updateDoc(doc(db,'pekerjaan',d.id),{status:'terisi'});
                tampilkanLowongan();
              };
            } else {
              btn.disabled = true; btn.textContent = "Hanya pembuat";
            }
          }
          box.appendChild(card);
        });
        if (!box.innerHTML) box.innerHTML = "<p>Belum ada lowongan.</p>";
      } catch(err) {
        box.innerHTML = "<p style='color:red'>❌ Gagal memuat: "+err.message+"</p>";
      }
    }

    tampilkanLowongan();
  </script>
</body>
</html>
